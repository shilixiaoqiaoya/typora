### 左移/右移

`<<`运算符使指定值的**二进制数所有位都左移指定次数**，其移动规则：**丢弃高位，低位补0**即按二进制形式把所有的数字向左移动对应的位数，高位移出(舍弃)，低位的空位补零。

```javascript
// 1的二进制表示为: 00000000 00000000 00000000 00000001
// -----------------------------
// 2的二进制表示为: 00000000 00000000 00000000 00000010
console.log(1 << 1);  // 2
```



`>>`该操作符会将指定操作数的**二进制位向右移动指定的位数**。**向右被移出的位被丢弃，拷贝最左侧的位以填充左侧**。由于新的最左侧的位总是和以前相同，符号位没有被改变。所以被称作“符号传播”。

```javascript
// 1的二进制表示为: 00000000 00000000 00000000 00000001
// -----------------------------
// 0的二进制表示为: 00000000 00000000 00000000 00000000
console.log(1 >> 1); // 0
```







# 计算机网络

### 基本知识

- 大多数笔记本有两种网卡：**有线网卡和无线网卡**；手机内置无线网卡
- **每块网卡在出厂时会被烧制上全世界唯一的mac地址，mac地址是上网许可证**
  - 由12位16进制数表示，前6位是厂商编号，后6位是流水线号
  - `10:9f:41:d9:17:48`
  - <img src="https://cdn.jsdelivr.net/gh/shilixiaoqiaoya/pictures@master/image-20250630170117397.png" alt="image-20250630170117397" style="zoom:80%;" />
- **路由器至少有两块网卡，一块网卡NAT模式对应外网，一块网卡仅主机模式对应内网**
- 光猫
  - **光调制解调器，将光信号转换为电信号**
  - 当入户线是光纤的，需要光猫将光信号转换为电信号，然后连接路由器，其它终端设备连接路由器来上网
  - 如果入户线不是光纤，只要有个路由器就可以直接上网

- 设备带宽
  - 各个设备之间进行网络数据传输，如果电脑网卡是千兆网卡，而路由器是百兆路由器，那么上网的最高速度是百兆，千兆网卡浪费了

- 以太网：一种应用于**「局域网的有限网络技术」**，通过网线传输数据，相比无线网络更稳定

- 局域网以路由器做划分，子网/网段以交换机做划分

  







### 网络模型

- osi七层模型，是对原始数据做封装的逐步过程
- 加密 + 端口 + ip地址 + mac地址
- 表示层 --》 传输层tcp/udp --》  网络层 ip  --》 数据链路层

<img src="https://cdn.jsdelivr.net/gh/shilixiaoqiaoya/pictures@master/image-20250623101956913.png" alt="image-20250623101956913" style="zoom:80%;" />

- 数据包是存放在内存中一串二进制数字信息，**需要将数字信息转换为电信号，才能在网线上传输，负责这一操作的是网卡**







#### 传输层

- 规定了数据传输的方式

- TCP

  - 三次握手、四次挥手【可靠传输】

  - TCP段：当传输层的数据包大小超过MSS(TCP最大报文段长度)，就要把数据包分块，每个分块称为一个TCP段
  - <img src="https://cdn.jsdelivr.net/gh/shilixiaoqiaoya/pictures@master/image-20250623101100297.png" alt="image-20250623101100297" style="zoom:70%;" />
  - 状态位：SYN建立连接；ACK回复；FIN结束连接

- UDP

  - 只负责发送数据包，不保证数据是否抵达对方【不可靠传输】

  - 实时性更好
- 真正进行通信的实体是主机中的进程，是一台主机的一个进程和另一台主机中的一个进程在交换数据
  - ip协议可以把数据报文送到目的主机，但并没有交付给主机的具体应用进程
  
  - **端口对端口的通信是应用进程之间的通信「ip: 端口」**
  
- 端口
  - **一台主机上运行着很多程序，通过端口号将程序区分开来**
  - 服务端的服务程序的端口是固定的（http端口是80，https端口是443）
  - 客户端根据ip和端口进行连接通信，ip固定，端口是系统随机分配的
- **公网IP的某个端口到内网IP的某个端口的映射通常是一对一的**





#### 网络层

- IP地址有两部分组成：网络号+主机号
  - 网络号：标识IP地址属于哪个子网
  - 主机号：标识同一子网下的不同主机

- 子网掩码
  - 子网掩码的二进制数只能是1在前边，0在后边
  - 决定了一个网段的大小，网段越大，ip地址越多

```js
// 每位可能的值
11111111 255
11111110 254
11111100 252
11111000 248
11110000 240
11100000 224
11000000 192
10000000 128
00000000 0
```

- 子网掩码和两个不同内网ip地址做「与运算」，如果结果相同则两个ip地址在同一网段
  - 同一网段（同一交换机下）的ip地址，物理线路接通就可以直接相互通信

  - 不同网段的ip地址，即使物理线路接通也不能通信，需要路由器，路由器帮助转发到对应网段的主机上


```text
192.168.100.126/25 ---> ip地址：192.168.100.126 子网掩码：255.255.255.128
192.168.100.129/25 ---> ip地址：192.168.100.129 子网掩码：255.255.255.128
子网掩码 ==》 255.255.255.128：11111111.11111111.11111111.10000000 

192.168.100.126 --> 11000000 10101000 01100100 01111110
11111111 11111111 11111111 10000000
逻辑与计算，结果：
192.168.100.0

192.168.100.129 --> 11000000 10101000 01100100 10000001
11111111 11111111 11111111 10000000
逻辑与计算，结果：
192.168.100.1

计算结果不同，这两个内网ip不在一个网段（一个交换机下）
```

- 电脑的内网ip地址，默认是DHCP服务给自动分配的

- **ip报文需要有源地址Ip和目标地址Ip，二者在传输过程中始终不变**

  - 当客户端有多个网卡时，需要根据目标地址来判断使用哪个网卡

  ```js
  本机网卡: 
  ①192.168.3.0，子网掩码255.255.255.0
  ②192.168.10.0,子网掩码255.255.255.0
  ③0.0.0.0,子网掩码0.0.0.0 【如果其它网卡无法匹配，会自动匹配这个网卡】
  
  当目标ip是 192.168.10.200，使用第二个网卡
  当目标ip是 10.100.20.100，使用第三个网卡
  ```




<img src="https://cdn.jsdelivr.net/gh/shilixiaoqiaoya/pictures@master/image-20250630165312913.png" alt="image-20250630165312913" style="zoom:87%;" />

- ipv4，ip地址总数约为43亿个，不够用，所以将部分ip地址剥离出作为内部ip使用，每个局域网的终端设备使用这些内网ip，它们共用一个公网ip来进行上网
- 只有公网ip才可以上网，需要一个技术将内网ip转换为公网ip，就是NAT（网络地址转换）技术，它内置在路由器上











#### 数据链路层

- 每台上网设备都有n个网卡，有线网卡或无线网卡，每个网卡有全球独一无二的mac地址（物理地址），是出厂时烧制上去的
- **mac头部需要有发送方的mac地址和接收方目标mac地址，二者在传输过程中会变**
  - 在发送数据包时，如果目标主机不是局域网中的，目标mac是路由器

- **同一子网内，利用arp协议，有每台主机内网ip和mac地址之间的映射关系**

- 举个例子，A主机到B主机数据包经历了三跳

| 跳数      | 源Mac                  | 目标Mac                            |
| --------- | ---------------------- | ---------------------------------- |
| A --> R1  | A的网卡Mac             | A的默认网关R1，接口1的mac: R1_MAC1 |
| R1--> R2  | R1接口2的Mac： R1_MAC2 | R2接口1的Mac: R2_MAC1              |
| R2 --> R3 | R2接口2的Mac: R2_MAC2  | R3接口1的Mac: R3_MAC1              |
| R3 --> B  | R3接口2的Mac: R3_MAC2  | B的网卡Mac                         |



![image-20250630165227782](https://cdn.jsdelivr.net/gh/shilixiaoqiaoya/pictures@master/image-20250630165227782.png)

- arp广播风暴
  - 如果交换机连接的主机很多，一次广播很耗费资源，当广播次数变多，很容易造成网络堵塞









### 输入一个网址

![image-20250623104036939](https://cdn.jsdelivr.net/gh/shilixiaoqiaoya/pictures@master/image-20250623104036939.png)

#### 资源寻找

<img src="https://cdn.jsdelivr.net/gh/shilixiaoqiaoya/pictures@master/image-20250623110058166.png" alt="image-20250623110058166" style="zoom:87%;" />

- web服务的根目录是配置文件中指定的，是操作系统中某个子目录，放置静态资源

```js
1、用户请求：https://example.com/images/photo.jpg
2、服务器解析
web根/：系统路径/var/www/html
最终返回文件 /var/www/html/images/photo.jpg
```

- 当请求的url中没有path部分时，请求的是web服务根目录下的`index.html`文件
- **注意：后端通过`/user/info`类似的path请求内容，`/user/info`和web服务的根目录无关，是由后端的路由系统管理的**



#### DNS

<img src="https://cdn.jsdelivr.net/gh/shilixiaoqiaoya/pictures@master/image-20250623111411560.png" alt="image-20250623111411560" style="zoom:77%;" />

- 本地dns服务器可以是公司自己搭建的，可以是大厂的dns服务器

> - 全球有13个根域名服务器，主根服务器在美国，其余12个为辅根，其中9个在美国，2个在欧洲，1个在亚洲
> - 当年美军攻打伊拉克，让伊拉克在互联网上消失了，将所有伊拉克的网站网址解析到了一个错误的ip地址，导致别人都访问不了伊拉克的网站
> 	- 【利用dns劫持】
> - 在与现有IPV4根服务架构充分兼容基础上，‘雪人计划’于全球新增25个IPV6根服务器，中国部署了其中的4台，由一台主根和3台辅根组成，打破了中国过去没有根服务器的困境。所以中国现在主推IPV6，提高网络自主权

<img src="https://cdn.jsdelivr.net/gh/shilixiaoqiaoya/pictures@master/image-20250630183328176.png" alt="image-20250630183328176" style="zoom:67%;" />







### IP

- 网络层作用：实现主机与主机之间的通信，点对点通信
- 分为三类

<img src="https://cdn.jsdelivr.net/gh/shilixiaoqiaoya/pictures@master/image-20250624145919854.png" alt="image-20250624145919854" style="zoom:67%;" />

- 内网ip

  - 绝大多数的IP地址都是公有地址，全球唯一，需要向国际互联网信息中心申请注册

  - **在IPV4地址协议中预留了3个IP地址段，作为私有地址，供组织机构内部使用**，这三个地址段分别位于A、B、C三类地址内
    - A类地址中有：10.0.0.0 ~ 10.255.255.255   
    
    - B类地址中有：172.16.0.0 ~ 172.31.255.255 
    
    - C类地址中有：192.168.0.0 ~ 192.168.255.255 
    
  - 这些私有地址在组织内网中，可重复出现在不同公司组织内部
  - 如图，两个私有ip地址转换为公网ip，以不同的端口作为区分

![image-20250624152208686](https://cdn.jsdelivr.net/gh/shilixiaoqiaoya/pictures@master/image-20250624152208686.png)

- 本地回环地址 
  - **`127.0.0.1` 指向localhost本机，使用这个ip时，数据包不会流向网络**





#### 域名

- **根域名：严格来说，每个域名末尾存在一个隐形的根域小数点，这个点表示根域名服务器，是dns层级的起点**
- 顶级域名有 .com（商业机构） .org（组织） .edu（教育机构）
- 地区顶级域名.cn (中国)   .us(美国)
- 新通用顶级域名 .app 、 .ai
- 子域名有：www用于标识一个服务器提供网页服务

```text
https://www.example.com.
顶级域名/一级域: .com
主域名/二级域: example 【通常是公司或个人自行注册和管理】
子域名: www
```









#### 数据包流转路径

![image-20250624151552745](https://cdn.jsdelivr.net/gh/shilixiaoqiaoya/pictures@master/image-20250624151552745.png)







### linux网络命令

- 查询域名DNS解析结果 `nslookup example.com`

- 查询DNS详细解析结果 `dig example.com`
- 查询cname记录 `dig cname example.com`
- 查看完整路由路径  `traceroute example.com`
- 测试连通性和解析ip  `ping example.com`







# 操作系统

- **接收和发送消息给硬件**

- **需要管理和调度应用**

<img src="https://cdn.jsdelivr.net/gh/shilixiaoqiaoya/pictures@master/image-20250714154241716.png" alt="image-20250714154241716" style="zoom:43%;" />

- *管理硬件设备、资源以及应用程序「管理能力」*
- *将硬件能力、资源抽象成服务让应用程序使用「抽象能力」*



【并发会提高系统资源利用率和系统吞吐量，并行不会】





### 架构



<img src="https://cdn.jsdelivr.net/gh/shilixiaoqiaoya/pictures@master/image-20250717155535965.png" alt="image-20250717155535965" style="zoom:50%;" />

时钟管理

- 计时：提供系统时间
- 时钟中断：比如进程切换
  - 提高多道程序环境下cpu利用率







### 进程

- **进程是程序的一次执行**
  - **是一个程序及其数据在处理机上执行时所发生的活动**
  - 是系统进行资源分配和调度的基本单位

- 特征
  - 动态性：由创建而生，由撤销而亡
  - 并发性：多个进程同时运行
  - 独立性：独立资源分配


<img src="https://cdn.jsdelivr.net/gh/shilixiaoqiaoya/pictures@master/image-20250716112743068.png" alt="image-20250716112743068" style="zoom:40%;" />

### 线程

- **也叫「轻量级进程」，每个线程有独立的程序计数器，记录程序执行位置**  
  - 是cpu运算调度的基本单位
  - **线程相对于进程，大大降低了创建、撤销和切换可执行实体的成本和难度**

<img src="https://cdn.jsdelivr.net/gh/shilixiaoqiaoya/pictures@master/image-20250716143715139.png" alt="image-20250716143715139" style="zoom:40%;" />

- 线程状态
  - 等待cpu时，称为**「就绪态」**
  - cpu执行该线程时，称为**「运行态」**
  - 线程在运行中，向硬盘发送访问请求，此时线程为**「阻塞态」**，cpu转而执行其他线程，硬盘回复数据后，线程变为就绪态，等待cpu再次执行

<img src="https://cdn.jsdelivr.net/gh/shilixiaoqiaoya/pictures@master/image-20250716145015574.png" alt="image-20250716145015574" style="zoom:40%;" />

- 线程分类

  - 计算密集型：长时间占用cpu
  - i/o密集型：cpu计算时间短，访问外接设备(如磁盘)时间长，次数多
  - 随着发展，芯片的计算速度越来越快，磁盘读写速度相对较慢，现在更多是考虑优化i/o密集型线程

  ```text
  nodejs能够处理大量并发i/o操作，特别适合i/o密集型应用
  - nodejs主线程将i/o操作委托给libuv线程池
  - 主线程继续执行后续js代码
  - i/o完成后，回调会被放入事件队列
  - 事件循环将回调移到主线程执行
  【读写文件、数据库查询、网络i/o；操作耗时不确定，取决于磁盘速度、数据库负载、网络情况】
  ```

  



### 死锁

- **多个进程由于竞争资源而造成的阻塞现象，若无外力作用，这些进程将无法继续推进**
- 产生原因
  - 系统资源的竞争
  - 进程推进顺序非法









# 计算机硬件

- 五个部分组成：运算器、控制器、存储器、输入设备、输出设备

<img src="https://cdn.jsdelivr.net/gh/shilixiaoqiaoya/pictures@master/image-20250630105234574.png" alt="image-20250630105234574" style="zoom:50%;" />

- cpu寄存器
  - **减少cpu和内存交换数据的次数，比内存速度快很多**
  - 比如指令寄存器：存正在执行的指令

- 软件分为系统软件和应用软件

  - 操作系统是系统软件，没有安装操作系统的电脑称之为裸机，裸机是不能直接安装应用软件的
  - **操作系统控制各个硬件协同工作**
  - **应用软件通过操作系统提供的接口来协调硬件设备工作**
  - <img src="https://cdn.jsdelivr.net/gh/shilixiaoqiaoya/pictures@master/image-20250701110134449.png" alt="image-20250701110134449" style="zoom:60%;" />
    - 隐藏了丑陋的硬件调用接口
    - 将应用程序对硬件资源的竞态请求变得有序化
  
  
  <img src="https://cdn.jsdelivr.net/gh/shilixiaoqiaoya/pictures@master/image-20250630110744504.png" alt="image-20250630110744504" style="zoom:50%;" />



- 硬盘的数据存取速度很慢，出现了内存来作为硬盘和cpu交互数据的缓存区，平衡硬盘和cpu的速度差距问题
- 内存不能永久存储数据，断电之后数据会丢失，所以需要保存写入到硬盘上







## cpu

- 中央处理器是计算机信息运行、程序处理的最终执行单元

- cpu架构是cpu厂商给属于同一系列的cpu产品定的一个制作规范，不同架构的cpu在制作时元件的个数、材质、处理指令的流程、指令集可能有所不同
  - x86架构：**intel、amd**都生产并主攻这个架构，主要应用在电脑（功耗高，性能高）
  - arm架构：主要应用在手机（功耗低，性能低）

- cpu主频：2.30GHz（千兆赫），意味着1秒可以运算23亿次运算
  - **主频越高，计算能力越强，耗电越高**
  - 当前大多数cpu都是多核的，cpu实际频率为主频 * 核心数 * 0.8
- Cpu核心数：**cpu内置的处理器个数，核心越多，性能越强**
  - 电脑可以同时打开多个程序，打开的程序运行起来进入到了内存，就是行进中的程序，称之为进程
  - 每个进程都需要cpu进行计算处理，这些进程可以称为cpu的任务，运行多个进程也就是多个任务，核心数越多，能够同时处理的任务越多
- Cpu三级缓存
  - CPU在计算过程中产生的中间数据需要临时存放到某个地方，这个地方就是缓存
  - 包括L1一级缓存，L2二级缓存，L3三级缓存，是cpu和内存之间的高速数据缓冲区
  - **L1最靠近cpu核心，运行速度最快，容量最小**
  - cpu会先去L1寻找需要的数据，找不见去L2找，还找不到去L3找，还找不到去内存找

- cpu位数
  - **64位表示cpu一次性计算的数据大小为64位(bit)的二进制数据**





## 存储器

<img src="https://cdn.jsdelivr.net/gh/shilixiaoqiaoya/pictures@master/image-20250717184535606.png" alt="image-20250717184535606" style="zoom:60%;" />

-  **硬盘缓存是硬盘的一部分**。当一个进程被操作系统挂起suspend时，把进程移出内存，放到硬盘缓存中
- **高速缓存是cpu的一部分**





### 内存RAM

- 作为cpu和硬盘之间交互数据的缓冲区，读写数据速度快，以提高cpu的使用效率

- 内存颗粒：内存中的芯片，内存的存储能力就靠它
  - 4g的内存，有8个内存颗粒，那么每个内存颗粒的空间大小是512MB
- 内存双通道技术
  - 当有两块内存条时，可以使用双通道技术，一块数据分两部分写入到两块内存条中，速度更快

<img src="https://cdn.jsdelivr.net/gh/shilixiaoqiaoya/pictures@master/image-20250630131052787.png" alt="image-20250630131052787" style="zoom:50%;" />

- 各进程的内存管理
  - 进程独立：各进程的程序指令地址不是物理地址，而是进程内部的相对地址
  - 进程保护：当有进程访问不是自己范围内的地址时，操作系统会干预保护

<img src="https://cdn.jsdelivr.net/gh/shilixiaoqiaoya/pictures@master/image-20250716162333266.png" alt="image-20250716162333266" style="zoom:33%;" />



#### 内存管理

- 连续分配
- 非连续分配







### 硬盘

- 机械硬盘hard disk drive(**HDD**)
  - 主要由马达、磁盘、磁头等组成
  - 磁盘上是磁性物质，通过控制小磁粒的极性来进行数据的存储（0/1）
- 固态硬盘solid state drive(**SSD**)
  - 电子存储，将电子通过绝缘层囚禁起来进行数据的存储
  - 比机械硬盘更加稳定耐用
- 「数据库」的核心数据是存储在磁盘上的，即使服务器重启，数据也不会丢失
  - **数据库运行时会用到大量内存，数据库会将经常访问的数据读到内存里，提高读写速度**
  - Redis所有数据都在内存中，极快，也可定期将数据快照存在磁盘，防止断电丢失
    - 适用场景：缓存——存储热点数据
  





## 显卡

- 将计算机需要显示的信息进行转换加工处理，并且驱动显示器，向显示器提供扫描信号，控制显示器的正确显示
- 是连接计算机主板和显示器的重要组件
- 主流显卡生产厂商：英伟达、amd
- 显卡主要由显卡主板、显示芯片、显示存储器等部分组成
  - **显卡芯片，也叫gpu，图形处理器，是显卡的主要处理单元**

- 显存
  - 也叫**帧缓存，它的作用是用来存储要处理的图形信息**
  - 图片越清晰，分辨率越高，占用的空间越大，就需要更大的显存空间【显存决定了最大支持的分辨率】

- **显存频率**
  - 显存在显卡上工作时的处理数据的频率

- **显存位宽**
  - 显存一次能传输的数据量

- **显存带宽**
  - 显存频率 * 显存位宽 / 8，**一秒内能传输的数据量，字节为单位**

- cuda核心
  - 显卡内部的处理器，数量越多，处理能力越强

- 刷新率 vs 帧率

<img src="https://cdn.jsdelivr.net/gh/shilixiaoqiaoya/pictures@master/image-20250630184118468.png" alt="image-20250630184118468" style="zoom:80%;" />



## 网卡

- 进行网络通信







# 浏览器

### 进程

- 进程是指令执行的上下文环境，包含：
  - 程序计数器：指向下一条待执行的指令地址
  - 寄存器状态：记录当前cpu运行现场
  - 线程：实际的指令执行单元
- **静态程序：存储在磁盘上的二进制文件，0101的机器码**
- **动态进程：当程序被加载到内存并运行时，操作系统为其创建的动态实体**
- 进程运行时，操作系统会向进程提供一块内存，所有应用状态都保留在此私有内存空间中

![image-20250701113148064](https://cdn.jsdelivr.net/gh/shilixiaoqiaoya/pictures@master/image-20250701113148064.png)

- 进程之间通过IPC通信，如果某个进程无响应，可以重启该进程，而无需停止运行应用不同部分的其它进程

![image-20250701113132800](https://cdn.jsdelivr.net/gh/shilixiaoqiaoya/pictures@master/image-20250701113132800.png)



### 1、**浏览器进程**

- 控制地址栏、标签、返回和前进按钮

- **chrome中的服务化**

  Chrome正在进行架构变更，将浏览器进程的每个部分都作为服务运行，从而允许分成不同的进程或合并到一个进程

  - 当chrome在强大的硬件上运行时，浏览器进程可能会将每项服务拆分为不同的进程以提高稳定性
  - ![image-20250701120610153](https://cdn.jsdelivr.net/gh/shilixiaoqiaoya/pictures@master/image-20250701120610153.png)
  - 当chrome在资源受限的设备上运行，chrome会将服务合并到一个进程中，以节省内存占用空间
  - ![image-20250701120554811](https://cdn.jsdelivr.net/gh/shilixiaoqiaoya/pictures@master/image-20250701120554811.png)





#### ① 界面线程

- 用于绘制浏览器按钮和输入字段
- 在地址栏输入网址时，界面线程会解析「是搜索查询还是网址」，决定定向到搜索引擎还是请求的网站



#### ② 网络线程

- 当用户按下enter键时，界面线程会发起网络调用以获取网站内容，网络线程工作，标签出现旋转图标
- **响应正文开始传入后，网络线程会查看数据流的前几个字节**。响应的content-type指明了数据类型
  - 如果响应是html文件，数据会传递给渲染进程
  - 如果是zip文件或其他文件，则表示它是下载请求，数据会传递给下载管理器

- 有了响应数据，网络线程会告知界面线程数据已准备就绪
  - 界面线程会查找渲染进程渲染网页，浏览器进程向渲染进程发送IPC
  - <img src="https://cdn.jsdelivr.net/gh/shilixiaoqiaoya/pictures@master/image-20250701143452890.png" alt="image-20250701143452890" style="zoom:67%;" />
  - 渲染进程完成渲染后，会将IPC发送回浏览器进程，此时停止标签上的旋转图标，这之后js仍可以加载资源并渲染新视图

<img src="https://cdn.jsdelivr.net/gh/shilixiaoqiaoya/pictures@master/image-20250701144648359.png" alt="image-20250701144648359" style="zoom:67%;" />



#### ③ 存储线程

##### 工作流程

- 渲染进程发起存储请求
  - 比如：网页调用`localstorage.setItem('key', 'value')`
- 请求通过IPC发送到浏览器进程
  - 渲染进程不能直接操作磁盘，必须通过浏览器进程的存储线程处理
- 存储线程执行操作
  - 将数据写入磁盘
    - 存储线程会合并多次存储操作，减少磁盘IO
    - 高频访问数据缓存在内存中，减少磁盘读取
- 返回结果给渲染进程
  - 通过IPC通知渲染进程操作完成（成功/失败）



##### 存储类型

- Localstorage，保存在磁盘某一位置
  - 同一网站的多个标签页，localstorage是共享的，数据保持一致
  - 同一个网站的存储大小为5MB
- sessionstorage，保存在内存中，标签页关闭后清除
- Cookie，保存在磁盘某一位置



### 2、渲染进程

- **浏览器为每个标签页创建一个渲染进程，某个标签页无响应不影响其它标签页**

<img src="https://cdn.jsdelivr.net/gh/shilixiaoqiaoya/pictures@master/image-20250701114443637.png" alt="image-20250701114443637" style="zoom:60%;" />

- 进程隔离带来了更高的安全性和稳定性，但由于无法共内存而导致内存消耗增加
  - **进程有自己的私有内存空间，每个进程都需要加载和运行一些基础的程序库和引擎（比如v8引擎），这意味着每个进程内存用量会增加，因为同样的内容在每个进程都要存一份，不能共用**
  - 为了节省内存，chrome会对可以启动的进程数量施加限制，当达到限制时，chrome浏览器会在同一个渲染进程中运行来自同一网站的多个标签页
- **【网站隔离】**
  - 在「一个标签页对应一个渲染进程」的模型中，跨网站iframe在单个渲染进程中运行，在不同的网站之间共享内存
  - **从chrome67开始，一个标签页中每个跨网站Iframe会获得单独的渲染进程，通过进程隔离实现网站分离**
  - <img src="https://cdn.jsdelivr.net/gh/shilixiaoqiaoya/pictures@master/image-20250701121419662.png" alt="image-20250701121419662" style="zoom:67%;" />
  - 网站隔离并非仅仅分配不同的渲染程序那么简单，它从根本上改变了iframe相互通信的方式





#### 「Blink内核」

- Blink是浏览器的渲染引擎，负责解析、布局、绘制等核心逻辑

- **渲染进程负责运行Blink引擎和V8引擎，确认隔离和安全**

- 每个渲染进程都有独立的blink和v8，但部分代码共享，所有内存占用比理论值低

- **多进程架构的稳定性和安全性优势远大于内存开销，所以被广泛采用**





#### ① 主线程

##### 构建dom树

- 当渲染进程接收到html数据时，**主线程会开始解析html并将其转换为DOM**
- 在解析构建dom遇到图片、css、js外部资源时，会去逐个请求他们
- **当主线程遇到`<script>`标记时，它会暂停解析html文档，去加载并执行js代码**
  - **原因是js可以使用`document.write()`更改文档的形状，会更改整个dom结构，所以主线程必须等待js运行，才能继续解析html文档**
- 如果js未使用`document.write()`，可以在`<script>`标记添加async、defer属性，浏览器会异步加载运行js代码，不会阻塞html文档的解析
- **dom有两个作用**
  - **页面的内部表示**
  - **将查询或修改渲染的API暴露给JS**






##### 样式计算

- **主线程会解析CSS并确定每个dom节点的计算样式**，称之为computed styles





##### 布局

- **主线程会遍历dom和计算样式，并创建包含x、y坐标和边界框大小等信息的布局树**
  - `display:none`的元素不属于布局树，元素不会占据空间
  - `visibility:hidden`的元素属于布局树，元素会占据空间
  - 伪元素不会存在于DOM树中，会包含在布局树中
- **重排**



##### 「渲染流水线」

![image-20250702153531509](https://cdn.jsdelivr.net/gh/shilixiaoqiaoya/pictures@master/image-20250702153531509.png)



##### 分层

- 主线程会使用一套复杂的策略对整个布局树进行分层，确定哪些元素放置在哪一层
- **如果期望网页的某些部分为单独的层，可以使用css属性`will-change`向浏览器发出提示**
- 好处：将来某一个层改变后，仅对该层进行后续处理



##### 绘制

- **主线程会为每个层单独产生绘制指令集，用于描述这一层的内容该如何画出来**
- **重绘**



##### 合成

- 主线程会将每个图层的绘制信息提交给合成线程
- 合成线程会对每个图层进行分块，将其划分为更多的小区域



####  ② 合成器线程

- 图层可能很大，此时合成线程会将其分为图块，并将每个图块发送到光栅线程
- 图块是栅格操作的单位 ，在栅格线程池中被栅格化，生成对应位图
- 合成是指光栅化后的图层组合在一起创建网页的过程



#### ③ 光栅线程

- 光栅化的结果是一块一块的位图
- 位图
  - 由像素构成的二位数字图像，每个像素存储特定的颜色信息，每个像素占用3/4个字节(RGBA)
  - 放大后会失真，因为像素点被强行拉伸
  - 文件格式：jpeg、png






#### ④ 预解析线程

- 提前下载HTML中的外部CSS文件和JS文件
- 当主线程解析到link位置，此时css文件还没有下载解析好，主线程不会等待，继续解析后续的html
- 当主线程解析到script位置，会停止html解析，等待js文件下载并执行，才能继续解析html





### 3、GPU进程

